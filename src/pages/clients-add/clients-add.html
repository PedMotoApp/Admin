<ion-header class="bg-theme">
  <ion-navbar>
    <ion-title style="color: white; font-size: 16px;">
      <span>{{ payload ? dataText.edit : dataText.add }} {{dataText.clients}}</span>
    </ion-title>
  </ion-navbar>
</ion-header>

<ion-content class="page-clients-add" style="background: #f4f5f8;">
  <ion-grid style="padding: 10px;">
    <!-- Imagem do Perfil -->
    <ion-row *ngIf="base64Image" style="justify-content: center; margin-bottom: 10px;">
      <ion-col col-12 style="text-align: center;">
        <img [src]="base64Image" style="border-radius: 50%; width: 80px; height: 80px; object-fit: cover;" />
        <button ion-button clear small (click)="selectPicture()" style="color: #007bff;">
          {{ dataText.changePic }}
        </button>
        <button ion-button clear small (click)="delPicture()" style="color: #ff4500;">
          {{ dataText.remove }}
        </button>
      </ion-col>
    </ion-row>
    <ion-row *ngIf="!base64Image" style="justify-content: center; margin-bottom: 10px;">
      <ion-col col-12 style="text-align: center;">
        <button ion-button small (click)="selectPicture()" style="background: linear-gradient(90deg, #007bff, #00c4ff); color: white;">
          {{ dataText.addPic }}
        </button>
      </ion-col>
    </ion-row>

    <!-- Botão de Preenchimento Automático (Visível apenas em ambiente de teste) -->
    <ion-row *ngIf="dataInfo.isTest">
      <ion-col col-12 style="text-align: center;">
        <button ion-button small (click)="fillRandomValues()">Fill Random (Dev)</button>
      </ion-col>
    </ion-row>

    <!-- Formulário -->
    <form [formGroup]="formGroup" novalidate>
      <ion-row>
        <!-- Razão Social -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.companyName}}</ion-label>
            <ion-input type="text" formControlName="razaoSocial" maxlength="100" (keyup.enter)="focusNext($event, 'cnpj')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('razaoSocial') && formGroup.get('razaoSocial').invalid && formGroup.get('razaoSocial').touched">
            <span *ngIf="formGroup.get('razaoSocial') && formGroup.get('razaoSocial').errors && formGroup.get('razaoSocial').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('razaoSocial') && formGroup.get('razaoSocial').errors && formGroup.get('razaoSocial').errors.minlength">{{dataText.errorRegister1}}</span>
            <span *ngIf="formGroup.get('razaoSocial') && formGroup.get('razaoSocial').errors && formGroup.get('razaoSocial').errors.maxlength">{{dataText.errorRegister2}}</span>
          </ion-note>
        </ion-col>

        <!-- CNPJ -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.cnpj}}</ion-label>
            <ion-input type="text" formControlName="cnpj" maxlength="40" (keyup.enter)="focusNext($event, 'name')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('cnpj') && formGroup.get('cnpj').invalid && formGroup.get('cnpj').touched">
            <span *ngIf="formGroup.get('cnpj') && formGroup.get('cnpj').errors && formGroup.get('cnpj').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('cnpj') && formGroup.get('cnpj').errors && formGroup.get('cnpj').errors.minlength">{{dataText.errorRegister1}}</span>
            <span *ngIf="formGroup.get('cnpj') && formGroup.get('cnpj').errors && formGroup.get('cnpj').errors.maxlength">{{dataText.errorRegister2}}</span>
          </ion-note>
        </ion-col>

        <!-- Nome -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.name}}</ion-label>
            <ion-input type="text" formControlName="name" maxlength="40" (keyup.enter)="focusNext($event, 'lastName')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('name') && formGroup.get('name').invalid && formGroup.get('name').touched">
            <span *ngIf="formGroup.get('name') && formGroup.get('name').errors && formGroup.get('name').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('name') && formGroup.get('name').errors && formGroup.get('name').errors.minlength">{{dataText.errorRegister1}}</span>
            <span *ngIf="formGroup.get('name') && formGroup.get('name').errors && formGroup.get('name').errors.maxlength">{{dataText.errorRegister2}}</span>
          </ion-note>
        </ion-col>

        <!-- Sobrenome -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.lastName}}</ion-label>
            <ion-input type="text" formControlName="lastName" maxlength="40" (keyup.enter)="focusNext($event, 'postCode')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('lastName') && formGroup.get('lastName').invalid && formGroup.get('lastName').touched">
            <span *ngIf="formGroup.get('lastName') && formGroup.get('lastName').errors && formGroup.get('lastName').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('lastName') && formGroup.get('lastName').errors && formGroup.get('lastName').errors.minlength">{{dataText.errorRegister1}}</span>
            <span *ngIf="formGroup.get('lastName') && formGroup.get('lastName').errors && formGroup.get('lastName').errors.maxlength">{{dataText.errorRegister2}}</span>
          </ion-note>
        </ion-col>

        <!-- CEP -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.postcode}}</ion-label>
            <ion-input type="text" formControlName="postCode" maxlength="8" (keyup.enter)="focusNext($event, 'address')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('postCode') && formGroup.get('postCode').invalid && formGroup.get('postCode').touched">
            <span *ngIf="formGroup.get('postCode') && formGroup.get('postCode').errors && formGroup.get('postCode').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('postCode') && formGroup.get('postCode').errors && (formGroup.get('postCode').errors.minlength || formGroup.get('postCode').errors.maxlength)">{{dataText.errorRegister3}}</span>
          </ion-note>
        </ion-col>

        <!-- Endereço -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.address}}</ion-label>
            <ion-input type="text" formControlName="address" maxlength="300" (keyup.enter)="focusNext($event, 'district')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('address') && formGroup.get('address').invalid && formGroup.get('address').touched">
            <span *ngIf="formGroup.get('address') && formGroup.get('address').errors && formGroup.get('address').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('address') && formGroup.get('address').errors && formGroup.get('address').errors.minlength">{{dataText.errorRegister1}}</span>
            <span *ngIf="formGroup.get('address') && formGroup.get('address').errors && formGroup.get('address').errors.maxlength">{{dataText.errorRegister4}}</span>
          </ion-note>
        </ion-col>

        <!-- Bairro -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.district}}</ion-label>
            <ion-input type="text" formControlName="district" maxlength="300" (keyup.enter)="focusNext($event, 'state')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('district') && formGroup.get('district').invalid && formGroup.get('district').touched">
            <span *ngIf="formGroup.get('district') && formGroup.get('district').errors && formGroup.get('district').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('district') && formGroup.get('district').errors && formGroup.get('district').errors.minlength">{{dataText.errorRegister1}}</span>
            <span *ngIf="formGroup.get('district') && formGroup.get('district').errors && formGroup.get('district').errors.maxlength">{{dataText.errorRegister4}}</span>
          </ion-note>
        </ion-col>

        <!-- Estado -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.state}}</ion-label>
            <ion-input type="text" formControlName="state" maxlength="20" (keyup.enter)="focusNext($event, 'city')" (ionChange)="stateChanged($event)"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('state') && formGroup.get('state').invalid && formGroup.get('state').touched">
            <span *ngIf="formGroup.get('state') && formGroup.get('state').errors && formGroup.get('state').errors.required">{{dataText.required}}</span>
            <span *ngIf="formGroup.get('state') && formGroup.get('state').errors && formGroup.get('state').errors.minlength">{{dataText.errorRegister5}}</span>
            <span *ngIf="formGroup.get('state') && formGroup.get('state').errors && formGroup.get('state').errors.maxlength">Quantidade de caracteres deve ser menor que 20</span>
          </ion-note>
        </ion-col>

        <!-- Cidade -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.city}}</ion-label>
            <ion-input type="text" formControlName="city" maxlength="300" (keyup.enter)="focusNext($event, 'complement')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('city') && formGroup.get('city').invalid && formGroup.get('city').touched">
            <span *ngIf="formGroup.get('city') && formGroup.get('city').errors && formGroup.get('city').errors.required">{{dataText.required}}</span>
            <span *ngIf="formGroup.get('city') && formGroup.get('city').errors && formGroup.get('city').errors.minlength">{{dataText.errorRegister1}}</span>
            <span *ngIf="formGroup.get('city') && formGroup.get('city').errors && formGroup.get('city').errors.maxlength">{{dataText.errorRegister4}}</span>
          </ion-note>
        </ion-col>

        <!-- Complemento -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.complement}}</ion-label>
            <ion-input type="text" formControlName="complement" maxlength="300" (keyup.enter)="focusNext($event, 'numero')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('complement') && formGroup.get('complement').invalid && formGroup.get('complement').touched">
            <span *ngIf="formGroup.get('complement') && formGroup.get('complement').errors && formGroup.get('complement').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('complement') && formGroup.get('complement').errors && formGroup.get('complement').errors.minlength">{{dataText.errorRegister1}}</span>
            <span *ngIf="formGroup.get('complement') && formGroup.get('complement').errors && formGroup.get('complement').errors.maxlength">{{dataText.errorRegister4}}</span>
          </ion-note>
        </ion-col>

        <!-- Número -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.numberr}}</ion-label>
            <ion-input type="text" formControlName="numero" maxlength="5" (keyup.enter)="focusNext($event, 'tel')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('numero') && formGroup.get('numero').invalid && formGroup.get('numero').touched">
            <span *ngIf="formGroup.get('numero') && formGroup.get('numero').errors && formGroup.get('numero').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('numero') && formGroup.get('numero').errors && formGroup.get('numero').errors.minlength">{{dataText.errorRegister6}}</span>
            <span *ngIf="formGroup.get('numero') && formGroup.get('numero').errors && formGroup.get('numero').errors.maxlength">{{dataText.errorRegister7}}</span>
          </ion-note>
        </ion-col>

        <!-- Telefone -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.phone}}</ion-label>
            <ion-input type="tel" formControlName="tel" maxlength="11" (keyup.enter)="focusNext($event, 'cpf')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('tel') && formGroup.get('tel').invalid && formGroup.get('tel').touched">
            <span *ngIf="formGroup.get('tel') && formGroup.get('tel').errors && formGroup.get('tel').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('tel') && formGroup.get('tel').errors && (formGroup.get('tel').errors.minlength || formGroup.get('tel').errors.maxlength)">{{dataText.errorRegister8}}</span>
          </ion-note>
        </ion-col>

        <!-- CPF -->
        <ion-col col-12 col-md-6>
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.cpf}}</ion-label>
            <ion-input type="text" formControlName="cpf" maxlength="11" (keyup.enter)="focusNext($event, 'tablePrice')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('cpf') && formGroup.get('cpf').invalid && formGroup.get('cpf').touched">
            <span *ngIf="formGroup.get('cpf') && formGroup.get('cpf').errors && formGroup.get('cpf').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('cpf') && formGroup.get('cpf').errors && (formGroup.get('cpf').errors.minlength || formGroup.get('cpf').errors.maxlength)">{{dataText.errorRegister8}}</span>
          </ion-note>
        </ion-col>

        <!-- Tabela de Preços -->
        <ion-col col-12 col-md-6 *ngIf="tableArray && tableArray.length > 0">
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.tablePrice}}</ion-label>
            <ionic-selectable
              item-content
              formControlName="tablePrice"
              [items]="tableArray"
              itemValueField="name"
              itemTextField="name"
              [canSearch]="true"
              [isMultiple]="false"
              (onChange)="tableChanged($event)"
            >
            </ionic-selectable>
          </ion-item>
        </ion-col>

        <!-- Email (somente para novos registros) -->
        <ion-col col-12 col-md-6 *ngIf="!uid_">
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.email}}</ion-label>
            <ion-input type="email" formControlName="email" (keyup.enter)="focusNext($event, 'password')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('email') && formGroup.get('email').invalid && formGroup.get('email').touched">
            <span *ngIf="formGroup.get('email') && formGroup.get('email').errors && formGroup.get('email').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('email') && formGroup.get('email').errors && formGroup.get('email').errors.email">{{dataText.errorInvalidEmail}}</span>
          </ion-note>
        </ion-col>

        <!-- Senha (somente para novos registros) -->
        <ion-col col-12 col-md-6 *ngIf="!uid_">
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.password}}</ion-label>
            <ion-input type="password" formControlName="password" (keyup.enter)="focusNext($event, 'password1')"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('password') && formGroup.get('password').invalid && formGroup.get('password').touched">
            <span *ngIf="formGroup.get('password') && formGroup.get('password').errors && formGroup.get('password').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('password') && formGroup.get('password').errors && formGroup.get('password').errors.minlength">{{dataText.errorPasswordLength}}</span>
          </ion-note>
        </ion-col>

        <!-- Repetir Senha (somente para novos registros) -->
        <ion-col col-12 col-md-6 *ngIf="!uid_">
          <ion-item no-lines style="background: white; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <ion-label stacked>{{dataText.repeatPassword}}</ion-label>
            <ion-input type="password" formControlName="password1" (keyup.enter)="signUp()"></ion-input>
          </ion-item>
          <ion-note margin-left ion-text color="danger" *ngIf="formGroup.get('password1') && formGroup.get('password1').invalid && formGroup.get('password1').touched">
            <span *ngIf="formGroup.get('password1') && formGroup.get('password1').errors && formGroup.get('password1').errors.required">{{dataText.requestdField}}</span>
            <span *ngIf="formGroup.get('password1') && formGroup.get('password1').errors && formGroup.get('password1').errors.notMatching">{{dataText.passwordNotSame}}</span>
          </ion-note>
        </ion-col>
      </ion-row>
    </form>
  </ion-grid>
</ion-content>

<ion-footer>
  <ion-grid>
    <ion-row>
      <ion-col col-12>
        <button ion-button block class="btn-footer" (click)="signUp()" *ngIf="!uid_">
          {{dataText.add}}
        </button>
        <button ion-button block class="btn-footer" (click)="save()" *ngIf="uid_">
          {{dataText.update}}
        </button>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-footer>