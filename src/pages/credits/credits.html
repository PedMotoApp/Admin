
<ion-header>

  <ion-navbar text-center no-border-bottom>
    <ion-title>{{dataText.credits}}s</ion-title>
  </ion-navbar>  

  <div class="banner bg-theme" text-center color="primary">
    <h4>{{dataText.yourCreditsNow}}</h4>    
    <h1>{{dataText.currency}} {{dataInfo.userInfo.credits}}</h1>      
</div>

<ion-item no-lines>
  <ion-label stacked>{{dataText.howMuchCredits}}</ion-label>  
  <ion-select [(ngModel)]="addValue">        
    <ion-option value="10.01">{{dataText.currency}} 10.00</ion-option>    
    <ion-option value="50.01">{{dataText.currency}} 50.00</ion-option>
    <ion-option value="100.01">{{dataText.currency}} 100.00</ion-option>
    <ion-option value="150.01">{{dataText.currency}} 150.00</ion-option>
    <ion-option value="500.01">{{dataText.currency}} 500.00</ion-option>
  </ion-select>                          
</ion-item>

</ion-header>

<ion-content padding>
  <ion-row class="pagseguro" align-items-center *ngIf="!isLoaded">
    <ion-col col-2 col-md-1>
      <ion-spinner></ion-spinner>
    </ion-col>
    <ion-col>
      <p *ngIf="! errorSession">{{msgInit}}</p>
      <p *ngIf="errorSession">{{dataText.errorSession}}</p>
    </ion-col>
  </ion-row>
  
  <form [formGroup]="paymentForm" class="pagseguro" *ngIf="isLoaded" no-padding no-margin margin-top>
    
    <ion-list no-padding no-margin padding-top no-lines>
    
      <div *ngIf="paymentForm.value.paymentMethod == 'creditCard'">
  
        <div formGroupName="card">
          <ion-item>
            <ion-label stacked>{{dataText.cardNumber}}
              <ion-note margin-left ion-text color="danger" *ngIf="(paymentForm.get('card').hasError('number') || paymentForm.get('card').get('cardNumber').hasError('maxlength')) && paymentForm.get('card').get('cardNumber').touched">{{dataText.invalidCardNumber}}</ion-note>
              <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('card').get('cardNumber').valid && paymentForm.get('card').get('cardNumber').touched">{{dataText.requestdField}}</ion-note>
  
              <ion-note *ngIf="cardBrand && !paymentForm.get('card').get('cardNumber').invalid" color="primary">
                <img [src]="getCardImage()" padding-left>
              </ion-note>
            </ion-label>
            <ion-input type="tel" maxlength="16" formControlName="cardNumber" [attr.maxlength]="16" (ionChange)="getBrand()"></ion-input>
          </ion-item>
  
          <ion-item>
            <ion-label stacked>{{dataText.cardHolderName}}
              <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('card').get('name').valid && paymentForm.get('card').get('name').touched">{{dataText.requestdField}}</ion-note>
            </ion-label>
            <ion-input type="text" formControlName="name"  [attr.minlength]="12"></ion-input>
          </ion-item>
  
          <ion-row no-padding>
            <ion-col no-padding col-lg-4 col-6>
              <ion-item>
                <ion-label stacked>{{dataText.valid}}
                  <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('card').get('month').valid && paymentForm.get('card').get('month').touched">{{dataText.requestdMonth}}</ion-note>
                </ion-label>              
                <ion-select okText="OK" cancelText="{{dataText.cancel}}" formControlName="month" placeholder="Mês" [selectOptions]="{title: 'Mês'}"> 
                  <ion-option *ngFor="let month of expirationMonths" [value]="month">{{ month }}</ion-option>
                </ion-select>
              </ion-item>
            </ion-col>
            <ion-col no-padding col-lg-4 col-6> 
              <ion-item>
                <ion-label stacked>&nbsp;
                  <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('card').get('year').valid && paymentForm.get('card').get('year').touched">{{dataText.requestdYear}}</ion-note>
                </ion-label>
                <ion-select okText="OK" cancelText="{{dataText.cancel}}" formControlName="year" placeholder="Ano" [selectOptions]="{title: 'Ano'}">
                  <ion-option *ngFor="let year of expirationYears" [value]="year">{{ year }}</ion-option>
                </ion-select>
              </ion-item>
            </ion-col>
            <ion-col no-padding col-lg-4 col-12>
              <ion-item>
                <ion-label stacked>{{dataText.safeCode}}
                  <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('card').get('cvv').valid && paymentForm.get('card').get('cvv').touched">{{dataText.requestdField}}</ion-note>
                </ion-label>
                <ion-input type="tel" maxlength="6" formControlName="cvv" [attr.maxlength]="6"></ion-input>
              </ion-item>
            </ion-col>
          </ion-row>
  
          <ion-item *ngIf="installments">
            <ion-label stacked>{{dataText.installments}}
              <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('card').get('installments').valid && paymentForm.get('card').get('installments').touched">{{dataText.requestdField}}</ion-note>
            </ion-label>
            <ion-select okText="OK" cancelText="{{dataText.cancel}}" formControlName="installments">
              <ion-option *ngFor="let item of installments" [value]="item.quantity">{{ item.quantity }} x {{ item.installmentAmount | currency:'BRL':'symbol-narrow' }}</ion-option>
            </ion-select>
          </ion-item>
  
          <ion-item>
            <ion-label stacked>{{dataText.holderCpf}}
              <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('card').get('cpf').valid && paymentForm.get('card').get('cpf').touched">{{dataText.requestdField}}</ion-note>
            </ion-label>
            <ion-input type="tel" formControlName="cpf" maxlength="11"></ion-input>
          </ion-item>
  
        </div>
  
        <ion-item [class.no-border]="platform.is('core')">
          <ion-label stacked>{{dataText.birthDate}}
          </ion-label>
          <ion-datetime displayFormat="DD/MM/YYYY" max="2018-12-31" min="1920-01-01" doneText="OK" cancelText="{{dataText.cancel}}" formControlName="ionBirthDate"></ion-datetime>        
        </ion-item>
        
        <ion-item>
          <ion-label stacked>{{dataText.holderPhone}}
            <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('phone').valid && paymentForm.get('phone').touched">{{dataText.invalidNumber}}</ion-note>
          </ion-label>
          <ion-input type="tel" formControlName="phone" maxlength="11"></ion-input>
        </ion-item>
  
        <div formGroupName="address">
          <ion-item>
            <ion-label stacked>{{dataText.holderPostCode}}
              <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('address').get('postalCode').valid && paymentForm.get('address').get('postalCode').touched">Campo inválido</ion-note>
            </ion-label>
            
            <ion-input type="tel" maxlength="8" formControlName="postalCode" [attr.maxlength]="8" (change)="fetchZip(paymentForm.value.address.postalCode)"></ion-input>
          </ion-item>
  
          <ion-item>
            <ion-label stacked>{{dataText.holderAddress}}
              <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('address').get('street').valid && paymentForm.get('address').get('street').touched">{{dataText.requestdField}}</ion-note>
            </ion-label>
            <ion-input type="text" formControlName="street"></ion-input>
          </ion-item>
  
          <ion-item>
            <ion-label stacked>{{dataText.holderNumber}}
              <ion-note margin-left ion-text color="danger" *ngIf="!paymentForm.get('address').get('number').valid && paymentForm.get('address').get('number').touched">{{dataText.requestdField}}</ion-note>
            </ion-label>
            <ion-input type="text" maxlength="6" formControlName="number"></ion-input>
          </ion-item>
        </div>
  
      </div>        
  
    </ion-list>
  
    <ion-row justify-content-center>
      
      <ion-col right text-right>
        <button ion-button color="primary" icon-right (click)="doCheckout()" [disabled]="!paymentForm.valid || processing">
          {{dataText.pay}}
        </button>
      </ion-col>
    </ion-row>
    <ion-row>
  
    </ion-row>
  </form>
  
</ion-content>
